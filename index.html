<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>üìç –ù–∞–≤–∏–≥–∞—Ç–æ—Ä —Å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ç—Ä–µ–ª–∫–æ–π</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* iOS-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Å—Ç–∏–ª–∏ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
        }

        html {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #000;
            color: white;
            height: 100vh;
            height: -webkit-fill-available;
            width: 100vw;
            overflow: hidden;
            position: fixed;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: none;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: -webkit-fill-available;
            width: 100vw;
            background: #000;
            position: relative;
        }

        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–∞ */
        .nav-header {
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
        }

        .nav-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #FF2D55, #FF375F);
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .nav-text h1 {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .nav-text p {
            font-size: 13px;
            opacity: 0.7;
            margin-top: 2px;
        }

        /* –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã */
        .nav-upload-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-upload-btn:active {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(0.95);
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #000;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç—ã */
        .map-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            overflow: hidden;
            touch-action: none;
        }

        #mapCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
            background: #000;
        }

        /* –•–æ–ª—Å—Ç –¥–ª—è —Å–ª–µ–¥–∞ */
        .arrow-trail {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 90;
            pointer-events: none;
        }

        #trailCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
        }

        /* –°—Ç—Ä–µ–ª–∫–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è - –£–í–ï–õ–ò–ß–ï–ù–ê –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ */
        .location-arrow {
            position: absolute;
            width: 80px;
            height: 80px;
            z-index: 100;
            pointer-events: none;
            filter: drop-shadow(0 0 15px rgba(255, 45, 85, 0.7));
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform: translate(-50%, -50%);
        }

        .arrow-icon {
            width: 100%;
            height: 100%;
        }

        /* –ü–∞–Ω–µ–ª—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç */
        .coordinates-panel {
            position: absolute;
            bottom: 120px;
            left: 16px;
            right: 16px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 16px;
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 50;
        }

        .coord-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .coord-label {
            opacity: 0.7;
        }

        .coord-value {
            font-family: 'Menlo', 'Monaco', monospace;
            font-weight: 600;
            color: #FF2D55;
        }

        /* –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .control-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 12px;
            z-index: 100;
        }

        .control-btn {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 12px;
            padding: 12px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.2s;
            -webkit-touch-callout: none;
            user-select: none;
        }

        .control-btn:active {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(0.95);
        }

        .control-btn i {
            font-size: 20px;
        }

        .control-btn span {
            font-size: 11px;
            font-weight: 500;
        }

        .control-btn.active {
            background: linear-gradient(135deg, #FF2D55, #FF375F);
        }

        .control-btn.tracking {
            background: linear-gradient(135deg, #32D74B, #30D158);
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã */
        .indicators {
            position: absolute;
            top: 16px;
            left: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 50;
        }

        .indicator {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 10px 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .indicator i {
            font-size: 16px;
        }

        .indicator.good i { color: #32D74B; }
        .indicator.warning i { color: #FF9500; }
        .indicator.error i { color: #FF453A; }

        .indicator span {
            opacity: 0.9;
        }

        /* –ú–∞—Å—à—Ç–∞–± */
        .zoom-controls {
            position: absolute;
            right: 16px;
            bottom: 200px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 50;
        }

        .zoom-btn {
            width: 50px;
            height: 50px;
            border-radius: 25px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .zoom-btn:active {
            background: rgba(255, 255, 255, 0.1);
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ */
        .sensitivity-settings {
            position: absolute;
            top: 100px;
            left: 16px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            padding: 12px;
            z-index: 50;
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 180px;
        }

        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
        }

        .slider-label span:first-child {
            opacity: 0.8;
        }

        .slider-label span:last-child {
            color: #FF2D55;
            font-weight: 600;
        }

        .sensitivity-slider {
            width: 100%;
            height: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
        }

        .sensitivity-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #FF2D55;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 0 10px rgba(255, 45, 85, 0.5);
        }

        .toggle-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .toggle-btn.active {
            background: rgba(255, 45, 85, 0.5);
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 14px 20px;
            border-radius: 14px;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 300px;
            width: auto;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .notification i {
            font-size: 18px;
        }

        .notification.success i { color: #32D74B; }
        .notification.error i { color: #FF453A; }
        .notification.warning i { color: #FF9500; }

        /* –ó–∞–≥—Ä—É–∑—á–∏–∫ */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .loader.show {
            opacity: 1;
            pointer-events: all;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #FF2D55;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —Å—Ç—Ä–µ–ª–∫–∏ */
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        @keyframes moveDetection {
            0% { transform: translate(-50%, -50%) scale(1); }
            25% { transform: translate(-50%, -50%) scale(1.3); }
            50% { transform: translate(-50%, -50%) scale(1); }
            75% { transform: translate(-50%, -50%) scale(1.3); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .move-detected {
            animation: moveDetection 1s ease;
        }

        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-height: 700px) {
            .coordinates-panel {
                bottom: 100px;
                padding: 12px;
            }
            
            .control-panel {
                padding: 12px;
            }
            
            .control-btn {
                padding: 10px;
            }
            
            .location-arrow {
                width: 70px;
                height: 70px;
            }
        }

        @media (max-width: 400px) {
            .control-btn span {
                font-size: 10px;
            }
            
            .coordinates-panel {
                left: 8px;
                right: 8px;
            }
            
            .sensitivity-settings {
                width: 160px;
                left: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
        <div class="nav-header">
            <div class="nav-title">
                <div class="nav-icon">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="nav-text">
                    <h1>–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä</h1>
                    <p>–°—Ç—Ä–µ–ª–∫–∞ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –º–∞–ª–µ–π—à–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è</p>
                </div>
            </div>
            <button class="nav-upload-btn" id="navUploadBtn" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç—É">
                <i class="fas fa-map"></i>
            </button>
            <input type="file" id="mapUpload" accept="image/*" style="display: none;">
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
        <div class="main-content">
            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç—ã -->
            <div class="map-container" id="mapContainer">
                <canvas id="mapCanvas"></canvas>
                <!-- –•–æ–ª—Å—Ç –¥–ª—è —Å–ª–µ–¥–∞ -->
                <div class="arrow-trail">
                    <canvas id="trailCanvas"></canvas>
                </div>
                
                <!-- –°—Ç—Ä–µ–ª–∫–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è (–£–í–ï–õ–ò–ß–ï–ù–ê) -->
                <div class="location-arrow" id="locationArrow">
                    <svg class="arrow-icon" viewBox="0 0 100 100">
                        <defs>
                            <radialGradient id="arrowGrad" cx="50%" cy="50%">
                                <stop offset="0%" stop-color="#FF2D55"/>
                                <stop offset="50%" stop-color="#FF375F"/>
                                <stop offset="100%" stop-color="#FF1B40"/>
                            </radialGradient>
                            <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                                <feGaussianBlur stdDeviation="4" result="blur"/>
                                <feMerge>
                                    <feMergeNode in="blur"/>
                                    <feMergeNode in="blur"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>
                        <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ -->
                        <path d="M50 10 L65 50 L50 90 L35 50 Z" 
                              fill="url(#arrowGrad)" 
                              stroke="#FFFFFF" 
                              stroke-width="3"
                              filter="url(#glow)"/>
                        <!-- –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ -->
                        <path d="M50 20 L58 50 L50 80 L42 50 Z" 
                              fill="#FFFFFF" 
                              opacity="0.3"/>
                        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫—Ä—É–≥ -->
                        <circle cx="50" cy="50" r="15" fill="#FFFFFF" opacity="0.2"/>
                        <circle cx="50" cy="50" r="8" fill="#FFFFFF" opacity="0.8"/>
                        <!-- –í–Ω–µ—à–Ω–µ–µ —Å–≤–µ—á–µ–Ω–∏–µ -->
                        <circle cx="50" cy="50" r="25" fill="none" stroke="#FF2D55" stroke-width="2" opacity="0.3"/>
                    </svg>
                </div>
            </div>

            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã -->
            <div class="indicators">
                <div class="indicator" id="gpsStatus">
                    <i class="fas fa-satellite"></i>
                    <span>GPS: –ü–æ–∏—Å–∫ —Å–∏–≥–Ω–∞–ª–∞...</span>
                </div>
                <div class="indicator" id="movementStatus">
                    <i class="fas fa-running"></i>
                    <span>–î–≤–∏–∂–µ–Ω–∏–µ: –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</span>
                </div>
            </div>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ -->
            <div class="sensitivity-settings" id="sensitivitySettings">
                <div class="slider-container">
                    <div class="slider-label">
                        <span>–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</span>
                        <span id="sensitivityValue">10x</span>
                    </div>
                    <input type="range" min="1" max="20" value="10" class="sensitivity-slider" id="sensitivitySlider">
                </div>
                <div style="display: flex; gap: 8px;">
                    <button class="toggle-btn" id="turboModeBtn">
                        <i class="fas fa-rocket"></i> –¢—É—Ä–±–æ
                    </button>
                    <button class="toggle-btn" id="smoothModeBtn">
                        <i class="fas fa-wave-square"></i> –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ
                    </button>
                </div>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–æ–º -->
            <div class="zoom-controls">
                <button class="zoom-btn" id="zoomIn">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="zoom-btn" id="zoomOut">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="zoom-btn" id="resetView">
                    <i class="fas fa-crosshairs"></i>
                </button>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç -->
            <div class="coordinates-panel">
                <div class="coord-row">
                    <span class="coord-label">–°–º–µ—â–µ–Ω–∏–µ X:</span>
                    <span class="coord-value" id="offsetX">0 px</span>
                </div>
                <div class="coord-row">
                    <span class="coord-label">–°–º–µ—â–µ–Ω–∏–µ Y:</span>
                    <span class="coord-value" id="offsetY">0 px</span>
                </div>
                <div class="coord-row">
                    <span class="coord-label">–ü—Ä–æ–≥—Ä–µ—Å—Å:</span>
                    <span class="coord-value" id="progress">0%</span>
                </div>
                <div class="coord-row">
                    <span class="coord-label">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</span>
                    <span class="coord-value" id="activity">0%</span>
                </div>
            </div>
        </div>

        <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="control-panel">
            <button class="control-btn active" id="startTrackingBtn">
                <i class="fas fa-play"></i>
                <span>–°—Ç–∞—Ä—Ç</span>
            </button>
            <button class="control-btn" id="boostBtn">
                <i class="fas fa-bolt"></i>
                <span>–£—Å–∏–ª–∏—Ç—å</span>
            </button>
            <button class="control-btn" id="resetBtn">
                <i class="fas fa-redo"></i>
                <span>–°–±—Ä–æ—Å</span>
            </button>
            <button class="control-btn" id="statsBtn">
                <i class="fas fa-chart-line"></i>
                <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
            </button>
        </div>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div class="notification" id="notification">
            <i class="fas fa-info-circle"></i>
            <span id="notificationText">–°–æ–æ–±—â–µ–Ω–∏–µ</span>
        </div>

        <!-- –ó–∞–≥—Ä—É–∑—á–∏–∫ -->
        <div class="loader" id="loader">
            <div class="spinner"></div>
        </div>
    </div>

    <script>
        // –ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é —Å—Ç—Ä–µ–ª–∫–∏
        class SensitiveNavigator {
            constructor() {
                this.canvas = document.getElementById('mapCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.trailCanvas = document.getElementById('trailCanvas');
                this.trailCtx = this.trailCanvas.getContext('2d');
                this.locationArrow = document.getElementById('locationArrow');
                
                this.userImage = null;
                this.imagePosition = { x: 0, y: 0 };
                this.scale = 1;
                this.minScale = 0.1;
                this.maxScale = 3;
                
                // –ü–æ–∑–∏—Ü–∏—è —Å—Ç—Ä–µ–ª–∫–∏
                this.arrowPosition = { x: 0, y: 0 };
                this.trailPoints = [];
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                this.sensitivity = 10; // –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (1-20)
                this.turboMode = false;
                this.smoothMode = true;
                this.trackingActive = false;
                this.boostActive = false;
                this.watchId = null;
                
                // –î–∞–Ω–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è
                this.movementHistory = [];
                this.lastAcceleration = { x: 0, y: 0, z: 0 };
                this.lastPosition = null;
                this.totalMovement = 0;
                this.movementThreshold = 0.05; // –ù–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏—è
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                this.startTime = null;
                this.movementCount = 0;
                this.lastMovementTime = 0;
                
                this.init();
            }
            
            init() {
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => this.resizeCanvas(), 100);
                });
                
                this.setupEventListeners();
                this.centerArrow();
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ–∫—É—é —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                document.getElementById('sensitivitySlider').value = this.sensitivity;
                document.getElementById('sensitivityValue').textContent = `${this.sensitivity}x`;
                
                this.showNotification('–ù–∞–≤–∏–≥–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω. –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ –º–∞–∫—Å–∏–º—É–º!', 'success', 4000);
            }
            
            resizeCanvas() {
                const container = document.getElementById('mapContainer');
                this.canvas.width = container.clientWidth;
                this.canvas.height = container.clientHeight;
                this.trailCanvas.width = container.clientWidth;
                this.trailCanvas.height = container.clientHeight;
                
                if (this.userImage) {
                    this.centerImage();
                } else {
                    this.drawWelcomeScreen();
                }
                
                this.drawTrail();
            }
            
            drawWelcomeScreen() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
                const gradient = this.ctx.createLinearGradient(0, 0, this.canvas.width, this.canvas.height);
                gradient.addColorStop(0, '#000000');
                gradient.addColorStop(1, '#1a1a2e');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const time = Date.now() / 1000;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                for (let i = 0; i < 5; i++) {
                    const radius = 50 + i * 30;
                    const opacity = 0.1 + Math.sin(time + i) * 0.1;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                    this.ctx.strokeStyle = `rgba(255, 45, 85, ${opacity})`;
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                }
                
                // –¢–µ–∫—Å—Ç
                this.ctx.font = 'bold 24px -apple-system, BlinkMacSystemFont';
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('–°–£–ü–ï–†-–ß–£–í–°–¢–í–ò–¢–ï–õ–¨–ù–´–ô', centerX, centerY - 40);
                this.ctx.fillText('–ù–ê–í–ò–ì–ê–¢–û–†', centerX, centerY);
                
                this.ctx.font = '16px -apple-system, BlinkMacSystemFont';
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                this.ctx.fillText('–°—Ç—Ä–µ–ª–∫–∞ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –º–∞–ª–µ–π—à–µ–µ –¥–≤–∏–∂–µ–Ω–∏–µ', centerX, centerY + 40);
                this.ctx.fillText('–ù–∞–∂–º–∏—Ç–µ "–°—Ç–∞—Ä—Ç" –¥–ª—è –Ω–∞—á–∞–ª–∞', centerX, centerY + 70);
            }
            
            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                if (this.userImage) {
                    this.ctx.save();
                    this.ctx.translate(this.imagePosition.x, this.imagePosition.y);
                    this.ctx.scale(this.scale, this.scale);
                    this.ctx.drawImage(this.userImage, 0, 0);
                    this.ctx.restore();
                    
                    // –†–∏—Å—É–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                    this.drawSensitivityIndicator();
                } else {
                    this.drawWelcomeScreen();
                }
                
                this.updateDisplay();
            }
            
            drawSensitivityIndicator() {
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const indicatorSize = 100 + (this.sensitivity * 10);
                
                // –í–Ω–µ—à–Ω–∏–π –∫—Ä—É–≥ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY, indicatorSize, 0, Math.PI * 2);
                this.ctx.strokeStyle = `rgba(255, 45, 85, ${0.1 + this.sensitivity / 40})`;
                this.ctx.lineWidth = 3;
                this.ctx.stroke();
                
                // –õ–∏–Ω–∏–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                for (let i = 0; i < 12; i++) {
                    const angle = (i / 12) * Math.PI * 2;
                    const lineLength = 20 + (this.sensitivity * 2);
                    
                    this.ctx.beginPath();
                    this.ctx.moveTo(
                        centerX + Math.cos(angle) * indicatorSize,
                        centerY + Math.sin(angle) * indicatorSize
                    );
                    this.ctx.lineTo(
                        centerX + Math.cos(angle) * (indicatorSize + lineLength),
                        centerY + Math.sin(angle) * (indicatorSize + lineLength)
                    );
                    this.ctx.strokeStyle = `rgba(255, 45, 85, ${0.3 + (i % 3) * 0.2})`;
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                }
            }
            
            drawTrail() {
                if (this.trailPoints.length < 2) {
                    this.trailCtx.clearRect(0, 0, this.trailCanvas.width, this.trailCanvas.height);
                    return;
                }
                
                this.trailCtx.clearRect(0, 0, this.trailCanvas.width, this.trailCanvas.height);
                
                // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Å–ª–µ–¥
                const gradient = this.trailCtx.createLinearGradient(0, 0, this.trailCanvas.width, this.trailCanvas.height);
                gradient.addColorStop(0, 'rgba(255, 45, 85, 0.8)');
                gradient.addColorStop(1, 'rgba(255, 59, 48, 0.5)');
                
                this.trailCtx.strokeStyle = gradient;
                this.trailCtx.lineWidth = 4;
                this.trailCtx.lineCap = 'round';
                this.trailCtx.lineJoin = 'round';
                
                this.trailCtx.beginPath();
                
                for (let i = 0; i < this.trailPoints.length; i++) {
                    const point = this.trailPoints[i];
                    const screenX = point.x * this.scale + this.imagePosition.x;
                    const screenY = point.y * this.scale + this.imagePosition.y;
                    
                    if (i === 0) {
                        this.trailCtx.moveTo(screenX, screenY);
                    } else {
                        this.trailCtx.lineTo(screenX, screenY);
                    }
                }
                
                this.trailCtx.stroke();
                
                // –¢–æ—á–∫–∏ –¥–≤–∏–∂–µ–Ω–∏—è
                this.trailCtx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                for (let i = 0; i < this.trailPoints.length; i += 5) {
                    const point = this.trailPoints[i];
                    const screenX = point.x * this.scale + this.imagePosition.x;
                    const screenY = point.y * this.scale + this.imagePosition.y;
                    
                    this.trailCtx.beginPath();
                    this.trailCtx.arc(screenX, screenY, 2 + (i % 3), 0, Math.PI * 2);
                    this.trailCtx.fill();
                }
            }
            
            centerArrow() {
                this.arrowPosition.x = this.canvas.width / 2;
                this.arrowPosition.y = this.canvas.height / 2;
                this.updateArrowPosition();
            }
            
            updateArrowPosition() {
                this.locationArrow.style.left = `${this.arrowPosition.x}px`;
                this.locationArrow.style.top = `${this.arrowPosition.y}px`;
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫—É –≤ –ø—É—Ç—å
                const mapX = (this.arrowPosition.x - this.imagePosition.x) / this.scale;
                const mapY = (this.arrowPosition.y - this.imagePosition.y) / this.scale;
                
                this.trailPoints.push({ x: mapX, y: mapY });
                
                if (this.trailPoints.length > 500) {
                    this.trailPoints.shift();
                }
                
                this.drawTrail();
            }
            
            // ===== –û–°–ù–û–í–ù–û–ô –ú–ï–¢–û–î –î–ï–¢–ï–ö–¶–ò–ò –î–í–ò–ñ–ï–ù–ò–Ø =====
            
            startMovementTracking() {
                if (!this.trackingActive) {
                    if (typeof DeviceMotionEvent !== 'undefined' && 
                        typeof DeviceMotionEvent.requestPermission === 'function') {
                        
                        DeviceMotionEvent.requestPermission()
                            .then(permissionState => {
                                if (permissionState === 'granted') {
                                    this.enableMovementTracking();
                                } else {
                                    this.showNotification('–î–æ—Å—Ç—É–ø –∫ –¥–∞—Ç—á–∏–∫–∞–º –∑–∞–ø—Ä–µ—â–µ–Ω', 'error');
                                }
                            })
                            .catch(error => {
                                console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞:', error);
                                this.showNotification('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞—Ç—á–∏–∫–∞–º', 'error');
                            });
                    } else {
                        this.enableMovementTracking();
                    }
                } else {
                    this.disableMovementTracking();
                }
            }
            
            enableMovementTracking() {
                this.trackingActive = true;
                this.startTime = Date.now();
                this.movementCount = 0;
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—ã—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
                window.addEventListener('devicemotion', this.handleDeviceMotion.bind(this), true);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                document.getElementById('startTrackingBtn').classList.remove('active');
                document.getElementById('startTrackingBtn').classList.add('tracking');
                document.getElementById('startTrackingBtn').innerHTML = '<i class="fas fa-stop"></i><span>–°—Ç–æ–ø</span>';
                
                document.getElementById('gpsStatus').className = 'indicator good';
                document.getElementById('gpsStatus').innerHTML = 
                    '<i class="fas fa-bolt"></i><span>–ß–£–í–°–¢–í–ò–¢–ï–õ–¨–ù–û–°–¢–¨: –í–ö–õ</span>';
                
                this.showNotification('–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω–æ! –î–≤–∏–≥–∞–π—Ç–µ—Å—å —Å–≤–æ–±–æ–¥–Ω–æ.', 'success');
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
                this.startSmoothUpdateLoop();
            }
            
            disableMovementTracking() {
                this.trackingActive = false;
                this.boostActive = false;
                
                window.removeEventListener('devicemotion', this.handleDeviceMotion.bind(this));
                
                document.getElementById('startTrackingBtn').classList.remove('tracking');
                document.getElementById('startTrackingBtn').classList.add('active');
                document.getElementById('startTrackingBtn').innerHTML = '<i class="fas fa-play"></i><span>–°—Ç–∞—Ä—Ç</span>';
                
                document.getElementById('gpsStatus').innerHTML = 
                    '<i class="fas fa-satellite"></i><span>GPS: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã–∫–ª</span>';
                
                this.showNotification('–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –≤—ã–∫–ª—é—á–µ–Ω–æ', 'info');
            }
            
            handleDeviceMotion(event) {
                if (!this.trackingActive) return;
                
                const acceleration = event.accelerationIncludingGravity || 
                                    event.acceleration || 
                                    { x: 0, y: 0, z: 9.81 };
                
                const rotation = event.rotationRate || { alpha: 0, beta: 0, gamma: 0 };
                const now = Date.now();
                
                // –£–°–ò–õ–ï–ù–ù–ê–Ø –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è
                const movement = this.calculateEnhancedMovement(acceleration, rotation);
                
                // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –¥–∞–∂–µ –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
                if (movement.intensity > this.movementThreshold) {
                    this.movementCount++;
                    this.lastMovementTime = now;
                    
                    // –£—Å–∏–ª–∏–≤–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫
                    const enhancedMovement = this.enhanceMovement(movement);
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –∫ —Å—Ç—Ä–µ–ª–∫–µ
                    this.applyMovementToArrow(enhancedMovement);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    this.updateMovementStats(movement);
                    
                    // –ê–Ω–∏–º–∞—Ü–∏—è —Å—Ç—Ä–µ–ª–∫–∏
                    this.animateArrowOnMovement();
                }
                
                this.lastAcceleration = acceleration;
            }
            
            calculateEnhancedMovement(acceleration, rotation) {
                // –í—ã—á–∏—Å–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É—Å–∫–æ—Ä–µ–Ω–∏—è
                const deltaX = Math.abs(acceleration.x - this.lastAcceleration.x);
                const deltaY = Math.abs(acceleration.y - this.lastAcceleration.y);
                const deltaZ = Math.abs(acceleration.z - this.lastAcceleration.z);
                
                // –£—á–∏—Ç—ã–≤–∞–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ
                const rotationFactor = (Math.abs(rotation.alpha) + Math.abs(rotation.beta) + Math.abs(rotation.gamma)) / 100;
                
                // –ö–æ–º–±–∏–Ω–∏—Ä—É–µ–º —Ñ–∞–∫—Ç–æ—Ä—ã –¥–≤–∏–∂–µ–Ω–∏—è
                const intensity = (deltaX + deltaY + deltaZ) * (1 + rotationFactor);
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
                const directionX = acceleration.x - this.lastAcceleration.x;
                const directionY = acceleration.y - this.lastAcceleration.y;
                
                return {
                    intensity: intensity * this.sensitivity,
                    directionX: Math.sign(directionX),
                    directionY: Math.sign(directionY),
                    rawDeltaX: deltaX,
                    rawDeltaY: deltaY,
                    rawDeltaZ: deltaZ,
                    rotation: rotationFactor
                };
            }
            
            enhanceMovement(movement) {
                let multiplier = this.sensitivity;
                
                if (this.turboMode) multiplier *= 2;
                if (this.boostActive) multiplier *= 3;
                
                // –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ
                if (this.smoothMode && this.movementHistory.length > 0) {
                    const lastMovement = this.movementHistory[this.movementHistory.length - 1];
                    movement.intensity = (movement.intensity + lastMovement.intensity) / 2;
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
                this.movementHistory.push({...movement, timestamp: Date.now()});
                if (this.movementHistory.length > 20) {
                    this.movementHistory.shift();
                }
                
                return {
                    intensity: movement.intensity * multiplier,
                    directionX: movement.directionX,
                    directionY: movement.directionY
                };
            }
            
            applyMovementToArrow(movement) {
                // –í—ã—á–∏—Å–ª—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ —Å —É—á–µ—Ç–æ–º —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                const moveDistance = movement.intensity * 5; // –ë–∞–∑–æ–≤–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö
                this.arrowPosition.x += movement.directionX * moveDistance;
                this.arrowPosition.y += movement.directionY * moveDistance;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–µ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
                this.totalMovement += moveDistance;
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏
                const padding = 100;
                this.arrowPosition.x = Math.max(padding, Math.min(this.canvas.width - padding, this.arrowPosition.x));
                this.arrowPosition.y = Math.max(padding, Math.min(this.canvas.height - padding, this.arrowPosition.y));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Å—Ç—Ä–µ–ª–∫–∏
                this.updateArrowPosition();
                
                // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫–∞—Ä—Ç—ã
                this.autoScrollMap();
            }
            
            autoScrollMap() {
                if (!this.userImage) return;
                
                const threshold = 150;
                const scrollSpeed = 8 + (this.sensitivity / 2);
                
                let needsRedraw = false;
                
                if (this.arrowPosition.x < threshold) {
                    this.imagePosition.x += scrollSpeed;
                    needsRedraw = true;
                } else if (this.arrowPosition.x > this.canvas.width - threshold) {
                    this.imagePosition.x -= scrollSpeed;
                    needsRedraw = true;
                }
                
                if (this.arrowPosition.y < threshold) {
                    this.imagePosition.y += scrollSpeed;
                    needsRedraw = true;
                } else if (this.arrowPosition.y > this.canvas.height - threshold) {
                    this.imagePosition.y -= scrollSpeed;
                    needsRedraw = true;
                }
                
                if (needsRedraw) {
                    this.draw();
                }
            }
            
            animateArrowOnMovement() {
                // –ü—É–ª—å—Å–∞—Ü–∏—è –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏
                this.locationArrow.classList.add('move-detected');
                
                setTimeout(() => {
                    this.locationArrow.classList.remove('move-detected');
                }, 1000);
                
                // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                const intensity = this.movementHistory.length > 0 ? 
                    this.movementHistory[this.movementHistory.length - 1].intensity : 0;
                
                if (intensity > 5) {
                    this.locationArrow.style.filter = 'drop-shadow(0 0 20px rgba(255, 204, 0, 0.8))';
                    setTimeout(() => {
                        this.locationArrow.style.filter = 'drop-shadow(0 0 15px rgba(255, 45, 85, 0.7))';
                    }, 300);
                }
            }
            
            updateMovementStats(movement) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                document.getElementById('offsetX').textContent = `${Math.round(this.arrowPosition.x - this.canvas.width/2)} px`;
                document.getElementById('offsetY').textContent = `${Math.round(this.arrowPosition.y - this.canvas.height/2)} px`;
                
                // –ü—Ä–æ–≥—Ä–µ—Å—Å (–ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è)
                const maxProgress = 1000;
                const progress = Math.min(100, Math.round((this.totalMovement / maxProgress) * 100));
                document.getElementById('progress').textContent = `${progress}%`;
                
                // –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                const activity = Math.min(100, Math.round(movement.intensity * 10));
                document.getElementById('activity').textContent = `${activity}%`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–≤–∏–∂–µ–Ω–∏—è
                const activityLevel = Math.min(5, Math.floor(activity / 20));
                const activityIcons = ['', 'üêå', 'üö∂', 'üèÉ', 'üöÄ', '‚ö°'];
                document.getElementById('movementStatus').innerHTML = 
                    `<i class="fas fa-running"></i><span>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${activityIcons[activityLevel]} ${activity}%</span>`;
            }
            
            startSmoothUpdateLoop() {
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ü–∏–∫–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
                const smoothUpdate = () => {
                    if (!this.trackingActive) return;
                    
                    // –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –¥–∞–∂–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                    if (Date.now() - this.lastMovementTime < 1000) {
                        // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–µ–±–æ–ª—å—à–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –ø–æ –∏–Ω–µ—Ä—Ü–∏–∏
                        const inertia = 0.3;
                        this.arrowPosition.x += (Math.random() - 0.5) * inertia * this.sensitivity;
                        this.arrowPosition.y += (Math.random() - 0.5) * inertia * this.sensitivity;
                        this.updateArrowPosition();
                    }
                    
                    requestAnimationFrame(smoothUpdate);
                };
                
                smoothUpdate();
            }
            
            // ===== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò =====
            
            loadImage(file) {
                if (!file.type.match('image.*')) {
                    this.showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', 'error');
                    return;
                }
                
                this.showLoader();
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        this.userImage = img;
                        this.centerImage();
                        this.showNotification(`–ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞: ${file.name}`, 'success');
                        this.hideLoader();
                        
                        // –û—á–∏—â–∞–µ–º –ø—É—Ç—å
                        this.trailPoints = [];
                        this.drawTrail();
                        this.centerArrow();
                    };
                    img.onerror = () => {
                        this.showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', 'error');
                        this.hideLoader();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
            
            centerImage() {
                if (!this.userImage) return;
                
                this.imagePosition.x = (this.canvas.width - this.userImage.width * this.scale) / 2;
                this.imagePosition.y = (this.canvas.height - this.userImage.height * this.scale) / 2;
                this.draw();
                this.drawTrail();
            }
            
            zoomIn() {
                if (this.scale < this.maxScale) {
                    this.scale *= 1.2;
                    this.adjustZoomPosition(1.2);
                    this.draw();
                    this.drawTrail();
                }
            }
            
            zoomOut() {
                if (this.scale > this.minScale) {
                    this.scale /= 1.2;
                    this.adjustZoomPosition(1/1.2);
                    this.draw();
                    this.drawTrail();
                }
            }
            
            adjustZoomPosition(factor) {
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                
                this.imagePosition.x = centerX - (centerX - this.imagePosition.x) * factor;
                this.imagePosition.y = centerY - (centerY - this.imagePosition.y) * factor;
            }
            
            resetView() {
                this.scale = 1;
                this.centerImage();
                this.centerArrow();
                this.totalMovement = 0;
                this.trailPoints = [];
                this.drawTrail();
                this.showNotification('–ü–æ–∑–∏—Ü–∏—è —Å–±—Ä–æ—à–µ–Ω–∞', 'info');
            }
            
            toggleTurboMode() {
                this.turboMode = !this.turboMode;
                const turboBtn = document.getElementById('turboModeBtn');
                turboBtn.classList.toggle('active', this.turboMode);
                
                this.showNotification(`–¢—É—Ä–±–æ-—Ä–µ–∂–∏–º ${this.turboMode ? '–≤–∫–ª—é—á–µ–Ω' : '–≤—ã–∫–ª—é—á–µ–Ω'}`, 'info');
            }
            
            toggleSmoothMode() {
                this.smoothMode = !this.smoothMode;
                const smoothBtn = document.getElementById('smoothModeBtn');
                smoothBtn.classList.toggle('active', this.smoothMode);
                
                this.showNotification(`–°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ ${this.smoothMode ? '–≤–∫–ª—é—á–µ–Ω–æ' : '–≤—ã–∫–ª—é—á–µ–Ω–æ'}`, 'info');
            }
            
            activateBoost() {
                this.boostActive = !this.boostActive;
                const boostBtn = document.getElementById('boostBtn');
                
                if (this.boostActive) {
                    boostBtn.classList.add('active');
                    boostBtn.innerHTML = '<i class="fas fa-bolt"></i><span>–£–°–ò–õ–ï–ù–û</span>';
                    this.showNotification('–£–°–ò–õ–ï–ù–ò–ï –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–û!', 'success');
                    
                    // –í—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                    setTimeout(() => {
                        this.boostActive = false;
                        boostBtn.classList.remove('active');
                        boostBtn.innerHTML = '<i class="fas fa-bolt"></i><span>–£—Å–∏–ª–∏—Ç—å</span>';
                        this.showNotification('–£—Å–∏–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'info');
                    }, 10000);
                } else {
                    boostBtn.classList.remove('active');
                    boostBtn.innerHTML = '<i class="fas fa-bolt"></i><span>–£—Å–∏–ª–∏—Ç—å</span>';
                }
            }
            
            showStats() {
                const timeActive = this.startTime ? 
                    Math.round((Date.now() - this.startTime) / 1000) : 0;
                
                const statsMessage = `
                    –ê–∫—Ç–∏–≤–Ω–æ–µ –≤—Ä–µ–º—è: ${timeActive} —Å–µ–∫
                    –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –¥–≤–∏–∂–µ–Ω–∏–π: ${this.movementCount}
                    –û–±—â–µ–µ —Å–º–µ—â–µ–Ω–∏–µ: ${Math.round(this.totalMovement)} px
                    –¢–µ–∫—É—â–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${this.sensitivity}x
                    ${this.turboMode ? '‚ö° –¢—É—Ä–±–æ-—Ä–µ–∂–∏–º: –í–ö–õ' : ''}
                    ${this.smoothMode ? 'üîÑ –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ: –í–ö–õ' : ''}
                `.trim().split('\n').map(line => line.trim()).join('\n');
                
                this.showNotification(statsMessage, 'info', 5000);
            }
            
            updateDisplay() {
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
                if (this.userImage) {
                    const centerX = this.canvas.width / 2;
                    const centerY = this.canvas.height / 2;
                    
                    const imgX = Math.round((centerX - this.imagePosition.x) / this.scale);
                    const imgY = Math.round((centerY - this.imagePosition.y) / this.scale);
                }
            }
            
            showNotification(message, type = 'info', duration = 3000) {
                const notification = document.getElementById('notification');
                const text = document.getElementById('notificationText');
                
                notification.className = `notification ${type}`;
                text.textContent = message;
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, duration);
            }
            
            showLoader() {
                document.getElementById('loader').classList.add('show');
            }
            
            hideLoader() {
                document.getElementById('loader').classList.remove('show');
            }
            
            setupEventListeners() {
                // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã
                document.getElementById('navUploadBtn').addEventListener('click', () => {
                    document.getElementById('mapUpload').click();
                });
                
                document.getElementById('mapUpload').addEventListener('change', (e) => {
                    if (e.target.files[0]) {
                        this.loadImage(e.target.files[0]);
                    }
                });
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º
                document.getElementById('startTrackingBtn').addEventListener('click', () => {
                    this.startMovementTracking();
                });
                
                document.getElementById('boostBtn').addEventListener('click', () => {
                    this.activateBoost();
                });
                
                document.getElementById('resetBtn').addEventListener('click', () => {
                    this.resetView();
                });
                
                document.getElementById('statsBtn').addEventListener('click', () => {
                    this.showStats();
                });
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                const sensitivitySlider = document.getElementById('sensitivitySlider');
                const sensitivityValue = document.getElementById('sensitivityValue');
                
                sensitivitySlider.addEventListener('input', (e) => {
                    this.sensitivity = parseInt(e.target.value);
                    sensitivityValue.textContent = `${this.sensitivity}x`;
                    
                    // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                    this.showNotification(`–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${this.sensitivity}x`, 'info', 1000);
                });
                
                // –†–µ–∂–∏–º—ã
                document.getElementById('turboModeBtn').addEventListener('click', () => {
                    this.toggleTurboMode();
                });
                
                document.getElementById('smoothModeBtn').addEventListener('click', () => {
                    this.toggleSmoothMode();
                });
                
                // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
                document.getElementById('zoomIn').addEventListener('click', () => this.zoomIn());
                document.getElementById('zoomOut').addEventListener('click', () => this.zoomOut());
                document.getElementById('resetView').addEventListener('click', () => this.resetView());
                
                // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã
                let isDragging = false;
                let dragStart = { x: 0, y: 0 };
                
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (this.userImage && e.touches.length === 1) {
                        isDragging = true;
                        dragStart.x = e.touches[0].clientX - this.imagePosition.x;
                        dragStart.y = e.touches[0].clientY - this.imagePosition.y;
                    }
                }, { passive: false });
                
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    if (isDragging && this.userImage && e.touches.length === 1) {
                        this.imagePosition.x = e.touches[0].clientX - dragStart.x;
                        this.imagePosition.y = e.touches[0].clientY - dragStart.y;
                        this.draw();
                        this.drawTrail();
                    }
                }, { passive: false });
                
                this.canvas.addEventListener('touchend', () => {
                    isDragging = false;
                });
                
                // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∂–µ—Å—Ç–æ–º
                let initialDistance = 0;
                
                this.canvas.addEventListener('touchstart', (e) => {
                    if (e.touches.length === 2 && this.userImage) {
                        initialDistance = Math.hypot(
                            e.touches[0].clientX - e.touches[1].clientX,
                            e.touches[0].clientY - e.touches[1].clientY
                        );
                    }
                });
                
                this.canvas.addEventListener('touchmove', (e) => {
                    if (e.touches.length === 2 && this.userImage && initialDistance > 0) {
                        e.preventDefault();
                        
                        const currentDistance = Math.hypot(
                            e.touches[0].clientX - e.touches[1].clientX,
                            e.touches[0].clientY - e.touches[1].clientY
                        );
                        
                        const delta = currentDistance - initialDistance;
                        if (Math.abs(delta) > 30) {
                            if (delta > 0) {
                                this.zoomIn();
                            } else {
                                this.zoomOut();
                            }
                            initialDistance = currentDistance;
                        }
                    }
                }, { passive: false });
                
                // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∂–µ—Å—Ç–æ–≤
                document.addEventListener('touchmove', (e) => {
                    if (e.target === this.canvas || e.target.closest('.map-container')) {
                        e.preventDefault();
                    }
                }, { passive: false });
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                window.navigator = new SensitiveNavigator();
            }, 100);
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∂–µ—Å—Ç–æ–º –Ω–∞ iOS
        document.addEventListener('gesturestart', (e) => {
            e.preventDefault();
        });
    </script>
</body>
</html>